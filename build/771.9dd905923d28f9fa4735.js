"use strict";(self.webpackChunkpayload_template_ts_blog=self.webpackChunkpayload_template_ts_blog||[]).push([[771],{59771:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var i=a(67294),l=a(16550),o=a(26793),s=a(9980),n=a(28630),d=a(47489),r=a(2143),c=a(58951),u=a(83780);const f=(e,t)=>t?e.fields.filter((e=>(0,u.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var p=a(19826),v=a(40684),m=a(45074),$=a(91455),g=a(30894);const h=e=>{var t,a,u;const{collection:h,isEditing:E}=e,{slug:S,admin:{components:{views:{Edit:b}={}}={}}={}}=h,[k]=(0,i.useState)((()=>f(h,E))),[_]=(0,i.useState)((()=>({...h,fields:k}))),[w,C]=(0,i.useState)(),Z=(0,v.bU)(),{serverURL:y,routes:{admin:P,api:L}}=(0,s.Z)(),{params:{id:U}={}}=(0,l.$B)(),{state:D}=(0,l.TH)(),R=(0,l.k6)(),[x,A]=(0,i.useState)(),{permissions:B,user:G}=(0,n.a)(),{getVersions:H,preferencesKey:K}=(0,m.x5)(),{getPreference:T}=(0,$.G)(),{t:V}=(0,o.$)("general"),j=(0,i.useCallback)((async e=>{var t;if(H(),E){const t=await(0,p.Z)({fieldSchema:_.fields,data:e.doc,user:G,id:U,operation:"update",locale:Z,t:V});A(t)}else C(`${P}/collections/${_.slug}/${null===(t=null==e?void 0:e.doc)||void 0===t?void 0:t.id}`)}),[P,_,E,H,G,U,V,Z]),[{data:q,isLoading:z,isError:F}]=(0,d.Z)(E?`${y}${L}/${S}/${U}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),I=(null==D?void 0:D.data)||q;if((0,i.useEffect)((()=>{if(z)return;(async()=>{const e=await(0,p.Z)({fieldSchema:k,data:I,user:G,operation:E?"update":"create",id:U,locale:Z,t:V});await T(K),A(e)})()}),[I,k,E,U,G,Z,z,K,T,V]),(0,i.useEffect)((()=>{w&&R.push(w)}),[R,w]),F)return i.createElement(l.l_,{to:`${P}/not-found`});const J=null===(t=null==B?void 0:B.collections)||void 0===t?void 0:t[S],M=`${y}${L}/${S}/${U}${_.versions.drafts?"?draft=true":""}`,N=`${y}${L}/${S}${E?`/${U}`:""}?locale=${Z}&depth=0&fallback-locale=null`,O=E&&(null===(a=null==J?void 0:J.update)||void 0===a?void 0:a.permission)||!E&&(null===(u=null==J?void 0:J.create)||void 0===u?void 0:u.permission);return i.createElement(g.f.Provider,{value:1},i.createElement(r.Z,{DefaultComponent:c.Z,CustomComponent:b,componentProps:{id:U,isLoading:!x,data:I,collection:_,permissions:J,isEditing:E,onSave:j,initialState:x,hasSavePermission:O,apiURL:M,action:N}}))}}}]);